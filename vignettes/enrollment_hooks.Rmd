---
title: "10 Insights from Wyoming School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{10 Insights from Wyoming School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5
)
```

```{r load-packages}
library(wyschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores Wyoming's public school enrollment data, surfacing key trends and demographic patterns across 25 years of data (2000-2024). Wyoming, America's least populous state, offers a unique window into rural education.

---

## 1. Wyoming educates fewer students than most urban districts

With under 95,000 K-12 students statewide, Wyoming's entire public school system is smaller than many individual urban districts elsewhere.

```{r statewide-data}
enr <- fetch_enr_multi(c(2000, 2005, 2010, 2015, 2020, 2024, use_cache = TRUE))

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#654321") +
  geom_point(size = 3, color = "#654321") +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  labs(
    title = "Wyoming Public School Enrollment (2000-2024)",
    subtitle = "America's least populous state: under 95,000 students total",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

For context: Denver Public Schools alone serves more students than all of Wyoming.

---

## 2. Energy booms and busts shape enrollment

Wyoming's coal, oil, and gas economy creates enrollment volatility. When energy prices rise, workers flood in; when they crash, families leave.

```{r energy-impact}
energy_years <- fetch_enr_multi(2010:2024, use_cache = TRUE)

state_trend <- energy_years |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(yoy_change = round((n_students / lag(n_students) - 1) * 100, 1))

state_trend
```

The 2015-2020 coal decline hit enrollment hard. Gillette and other Powder River Basin communities saw significant population loss.

---

## 3. Natrona and Laramie counties dominate enrollment

Casper (Natrona County) and Cheyenne (Laramie County) together serve nearly 40% of Wyoming's students.

```{r top-districts-data}
enr_2024 <- fetch_enr(2024, use_cache = TRUE)

top_districts <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(8) |>
  select(district_name, n_students)

top_districts
```

```{r top-districts-chart}
top_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = district_name)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_d(option = "plasma", begin = 0.2, end = 0.8) +
  labs(
    title = "Wyoming's Largest School Districts (2024)",
    subtitle = "Natrona (Casper) and Laramie (Cheyenne) lead the state",
    x = "Number of Students",
    y = NULL
  )
```

---

## 4. Wind River Reservation schools serve Native American students

The Eastern Shoshone and Northern Arapaho nations on the Wind River Reservation represent Wyoming's largest Native American population, concentrated in Fremont County.

```{r demographics-data}
demographics <- enr_2024 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "native_american", "hispanic", "asian", "black")) |>
  mutate(total = sum(n_students),
         pct = round(n_students / total * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Wyoming Student Demographics (2024)",
    subtitle = "Wind River Reservation drives Native American enrollment",
    x = "Number of Students",
    y = NULL
  )
```

---

## 5. Fremont County: Heart of Wind River country

Fremont County School Districts, serving communities around Lander, Riverton, and the Wind River Reservation, have distinct enrollment patterns.

```{r regional-data}
enr_multi <- fetch_enr_multi(2015:2024, use_cache = TRUE)

fremont <- enr_multi |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Fremont", district_name, ignore.case = TRUE)) |>
  group_by(end_year) |>
  summarize(total = sum(n_students, na.rm = TRUE)) |>
  mutate(pct_change = round((total / lag(total) - 1) * 100, 1))

fremont
```

```{r regional-chart}
ggplot(fremont, aes(x = end_year, y = total)) +
  geom_line(linewidth = 1.2, color = "#8B4513") +
  geom_point(size = 3, color = "#8B4513") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Fremont County Enrollment (2015-2024)",
    subtitle = "Wind River Reservation region enrollment trends",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 6. Campbell County's coal country exodus

Gillette and Campbell County saw massive enrollment declines as coal production fell. The Powder River Basin's bust reshaped local schools.

```{r campbell-trend}
campbell <- enr_multi |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Campbell", district_name)) |>
  select(end_year, district_name, n_students)

campbell_summary <- campbell |>
  group_by(end_year) |>
  summarize(total = sum(n_students, na.rm = TRUE)) |>
  mutate(pct_change = round((total / lag(total) - 1) * 100, 1))

campbell_summary
```

```{r campbell-chart}
ggplot(campbell_summary, aes(x = end_year, y = total)) +
  geom_line(linewidth = 1.2, color = "#2F4F4F") +
  geom_point(size = 3, color = "#2F4F4F") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Campbell County (Gillette) Enrollment (2015-2024)",
    subtitle = "Coal decline drives population loss",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 7. Teton County is the exception: Ski town growth

Jackson Hole bucks Wyoming's trends with population growth driven by tourism, remote workers, and outdoor recreation.

```{r growth-data}
teton <- enr_multi |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Teton", district_name)) |>
  select(end_year, district_name, n_students)

teton
```

```{r growth-chart}
teton |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Teton County (Jackson) Enrollment (2015-2024)",
    subtitle = "Ski town growth defies statewide trends",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 8. Vast distances define Wyoming education

Wyoming's 48 school districts serve 97,000 square miles - the 10th largest state. Many districts cover areas larger than some eastern states.

```{r district-size}
n_districts <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  summarize(
    n_districts = n(),
    total_students = sum(n_students, na.rm = TRUE),
    avg_per_district = round(total_students / n_districts)
  )

n_districts
```

With an average of around 2,000 students per district, Wyoming's districts are intimate by national standards but geographically immense.

---

## 9. Small schools are the Wyoming norm

Dozens of Wyoming schools serve fewer than 100 students, keeping education local in remote ranching and farming communities.

```{r small-schools}
school_sizes <- enr_2024 |>
  filter(is_school, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  mutate(size_category = case_when(
    n_students < 50 ~ "Under 50",
    n_students < 100 ~ "50-99",
    n_students < 250 ~ "100-249",
    n_students < 500 ~ "250-499",
    TRUE ~ "500+"
  )) |>
  count(size_category, name = "n_schools") |>
  mutate(size_category = factor(size_category,
         levels = c("Under 50", "50-99", "100-249", "250-499", "500+")))

school_sizes
```

---

## 10. Kindergarten trends signal the future

Kindergarten enrollment is the leading indicator for future enrollment. Wyoming's K numbers reveal what's coming.

```{r k-12-pipeline}
k_vs_12 <- enr_multi |>
  filter(is_state, subgroup == "total_enrollment", grade_level %in% c("K", "12")) |>
  select(end_year, grade_level, n_students) |>
  pivot_wider(names_from = grade_level, values_from = n_students)

k_vs_12
```

When kindergarten classes shrink, elementary, middle, and high schools will follow. Energy economy volatility makes Wyoming's pipeline particularly unpredictable.

---

## Summary

Wyoming's school enrollment data reveals:
- **America's smallest system**: Under 95,000 students statewide
- **Energy dependency**: Coal, oil, and gas booms/busts drive enrollment swings
- **Two-city state**: Casper and Cheyenne together serve ~40% of students
- **Wind River**: Native American students concentrated in Fremont County
- **Coal country exodus**: Campbell County (Gillette) losing students
- **Ski town exception**: Teton County (Jackson) growing against the trend
- **Small school tradition**: Dozens of schools with under 100 students

These patterns reflect Wyoming's unique position as America's least populous state, where energy economics and vast distances shape education.

---

*Data sourced from the Wyoming Department of Education [edu.wyoming.gov](https://edu.wyoming.gov/).*
